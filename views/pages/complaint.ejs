<% layout('/layouts/boilerplate.ejs') -%>

<!-- Page Header -->
<section class="page-header">
    <h1>Complaints</h1>
    <p>Track and manage all reported issues</p>
</section>

<!-- My Complaints Section -->
<h2 class="section-title">My Complaints</h2>
<div class="main-content">
    <div class="row">
        <% if (myComplaints.length === 0) { %>
        <div class="no-complaints">
            <p>No complaints reported yet.</p>
        </div>
        <% } %>
        <% myComplaints.forEach(c => { %>
        <div class="col-md-6 col-lg-4">
            <div class="complaint-card">
                <img src="<%= c.image ? ('/uploads/' + c.image) : 'https://images.unsplash.com/photo-1581578731117-e0a820a4b291?w=400&q=80' %>" class="card-img-top" alt="<%= c.category %>">
                <div class="card-body">
                    <span class="category-badge">
                        <% const cat = c.category ? c.category.trim().toLowerCase() : ''; %>
                        <% if (cat === 'water leakage') { %>
                            <i class="fas fa-tint"></i>
                        <% } else if (cat === 'garbage dump') { %>
                            <i class="fas fa-trash"></i>
                        <% } else if (cat === 'street light outage') { %>
                            <i class="fas fa-lightbulb"></i>
                        <% } else if (cat === 'pothole') { %>
                            <i class="fas fa-road"></i>
                        <% } else if (cat === 'drainage / sewage') { %>
                            <i class="fas fa-tint"></i>
                        <% } else { %>
                            <i class="fas fa-clipboard-list"></i>
                        <% } %>
                        <%= c.category %>
                    </span>
                    <p class="complaint-description">
                        <%= c.description %>
                    </p>
                    <div class="complaint-location">
                        <i class="fas fa-map-marker-alt"></i>
                        <span><%= c.location || 'Location not specified' %></span>
                    </div>
                    <div class="status-tracker">
                        <div class="status-tracker-title">
                            <i class="fas fa-shipping-fast"></i> Complaint Status
                        </div>
                        <div class="status-steps">
                            <div class="status-step <%= c.status === 'Assigned' || c.status === 'In Progress' || c.status === 'Completed' ? 'completed' : '' %>">
                                <div class="step-icon">
                                    <i class="fas fa-check"></i>
                                </div>
                                <span class="step-label">Assigned</span>
                            </div>
                            <div class="status-step <%= c.status === 'In Progress' || c.status === 'Completed' ? 'active' : '' %>">
                                <div class="step-icon">
                                    <i class="fas fa-tools"></i>
                                </div>
                                <span class="step-label">In Progress</span>
                            </div>
                            <div class="status-step <%= c.status === 'Completed' ? 'completed' : '' %>">
                                <div class="step-icon">
                                    <i class="fas fa-check-double"></i>
                                </div>
                                <span class="step-label">Completed</span>
                            </div>
                        </div>
                    </div>
                    <div class="complaint-meta">
                        <span><i class="far fa-calendar-alt"></i> 
                            <%= c.createdAt ? new Date(c.createdAt).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' }) : 'Date not specified' %>
                            <span style="margin-left:8px;"><i class="far fa-clock"></i> <%= c.createdAt ? new Date(c.createdAt).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', second: '2-digit' }) : 'Time not specified' %></span>
                        </span>
                        <span class="status-badge <%= c.status ? c.status.replace(' ', '-').toLowerCase() : '' %>">
                            <i class="fas fa-circle" style="font-size: 6px;"></i> <%= c.status || 'Status Unknown' %>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <% }) %>
    </div>
</div>

<hr>

<!-- Complaints by Others Section -->
<h2 class="section-title">Complaints by Others</h2>
<div class="main-content">
    <div class="row">
        <% if (otherComplaints.length === 0) { %>
        <div class="no-complaints">
            <p>No complaints by others yet.</p>
        </div>
        <% } %>
        <% otherComplaints.forEach(c => { %>
        <div class="col-md-6 col-lg-4">
            <div class="complaint-card">
                <img src="<%= c.image ? ('/uploads/' + c.image) : 'https://images.unsplash.com/photo-1581578731117-e0a820a4b291?w=400&q=80' %>" class="card-img-top" alt="<%= c.category %>">
                <div class="card-body">
                    <span class="category-badge">
                        <% const cat = c.category ? c.category.trim().toLowerCase() : ''; %>
                        <% if (cat === 'water leakage') { %>
                            <i class="fas fa-tint"></i>
                        <% } else if (cat === 'garbage dump') { %>
                            <i class="fas fa-trash"></i>
                        <% } else if (cat === 'street light outage') { %>
                            <i class="fas fa-lightbulb"></i>
                        <% } else if (cat === 'pothole') { %>
                            <i class="fas fa-road"></i>
                        <% } else if (cat === 'drainage / sewage') { %>
                            <i class="fas fa-tint"></i>
                        <% } else { %>
                            <i class="fas fa-clipboard-list"></i>
                        <% } %>
                        <%= c.category %>
                    </span>
                    <p class="complaint-description">
                        <%= c.description %>
                    </p>
                    <div class="complaint-location">
                        <i class="fas fa-map-marker-alt"></i>
                        <span><%= c.location || 'Location not specified' %></span>
                    </div>
                    <div class="status-tracker">
                        <div class="status-tracker-title">
                            <i class="fas fa-shipping-fast"></i> Complaint Status
                        </div>
                        <div class="status-steps">
                            <div class="status-step <%= c.status === 'Assigned' || c.status === 'In Progress' || c.status === 'Completed' ? 'completed' : '' %>">
                                <div class="step-icon">
                                    <i class="fas fa-check"></i>
                                </div>
                                <span class="step-label">Assigned</span>
                            </div>
                            <div class="status-step <%= c.status === 'In Progress' || c.status === 'Completed' ? 'active' : '' %>">
                                <div class="step-icon">
                                    <i class="fas fa-tools"></i>
                                </div>
                                <span class="step-label">In Progress</span>
                            </div>
                            <div class="status-step <%= c.status === 'Completed' ? 'completed' : '' %>">
                                <div class="step-icon">
                                    <i class="fas fa-check-double"></i>
                                </div>
                                <span class="step-label">Completed</span>
                            </div>
                        </div>
                    </div>
                    <div class="complaint-meta">
                        <span><i class="far fa-calendar-alt"></i> 
                            <%= c.createdAt ? new Date(c.createdAt).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' }) : 'Date not specified' %>
                            <span style="margin-left:8px;"><i class="far fa-clock"></i> <%= c.createdAt ? new Date(c.createdAt).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', second: '2-digit' }) : 'Time not specified' %></span>
                        </span>
                        <span class="status-badge <%= c.status ? c.status.replace(' ', '-').toLowerCase() : '' %>">
                            <i class="fas fa-circle" style="font-size: 6px;"></i> <%= c.status || 'Status Unknown' %>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <% }) %>
    </div>
</div>

<!-- Floating Report Button -->
<a href="/report" class="report-btn">
    <i class="fas fa-plus"></i>
</a>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>